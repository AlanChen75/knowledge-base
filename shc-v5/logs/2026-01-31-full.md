# SHC v5 完整工作日誌 — 2026-01-31

## Session 1: P0/P1/P2 修復 + 模擬測試

### 模擬測試第一輪（73.9%）
- 部署 test_simulation_v5.py 到 ac-mac
- 20 學員 × 46 場景模擬
- 結果：34/46 通過 (73.9%)
- 主要失敗原因：
  - M-SYS 未部署（20 次觸發全失敗）
  - M2 `source ~/.env` 在 dash shell 失敗（7 個）
  - M6 PPTX 50KB 門檻過高（4 個）
  - YAML 驗證失敗（1 個，gpt-4.1-nano 未用 | 多行語法）

### 根因分析
1. M-SYS: `docs/M-SYS-MODULE.yaml` 存在但未複製到 `skills/M-SYS/MODULE.yaml`
2. M2: `/bin/sh` 是 dash，不支援 `source`；deploy.sh 用相對路徑但 cwd 是 /tmp/workspace
3. M6: 舊 compile_pptx.sh 用 pandoc 無 --reference-doc，$TEMPLATE 參數被忽略
4. YAML: AgentCreator 無驗證重試機制

### P0 修復
- P0-a: 部署 M-SYS MODULE.yaml 到 skills/M-SYS/
- P0-b: hybrid_orchestrator.py 固定模組失敗 → fallback DynamicPlanner

### P1 修復
- 建立 output_delivery.py（GitHub repo push + TG Bot API 通知）
- 整合到 hybrid_orchestrator.py 的 _run_fixed() 和 dynamic 模式

### P2 修復
- P2-a: agent_creator.py YAML 驗證 + _fix_yaml() 重試（最多 2 次）
- P2-b: quality >= 0.9 自動核准 + 熱重載
- M2: `source` → `.`，deploy.sh 改絕對路徑
- M6: 門檻 50KB → 10KB

### 模擬測試第二輪（100%）
- 46/46 全部通過
- 13 個模組自動建立並啟用
- TG 通知確認可收到 + 下載

### 用戶反饋（品質問題）
- PPTX 無模板套用（pandoc 無 --reference-doc）
- 無品質驗證機制
- M2 只 fallback 不持續修復
- 測試場景缺乏真實交付物

## Session 2: M6 Pipeline 重建 + 靜態系統分析

### 依賴安裝
- Quarto 1.6.42: `curl + dpkg`
- LibreOffice 7.3.7.2: `apt install libreoffice-impress`
- python-pptx + lxml: 已安裝

### M6 MODULE.yaml 重建
- 用 scp 上傳（避免 heredoc 轉義問題）
- 7 步驟管線：plan → generate → compile → quality_check → llm_spot_check → deliver
- 品質驗證：PPTX → PDF(LibreOffice) → PNG(pdftoppm) → LLM 抽檢

### M6 端到端驗證
- 測試 QMD：AI 創業趨勢分析（6 頁）
- compile_pptx.sh + rich template → 34KB PPTX
- LibreOffice → PDF → pdftoppm → 6 張 PNG
- 關鍵發現：LibreOffice --convert-to png 只匯出第 1 頁，必須走 PDF 中間格式

### M2 端到端驗證
- 從 /tmp/workspace-test-m2（模擬 agent executor cwd）成功部署
- 驗證 URL：
  - https://ai-cooperation.github.io/workshop/test-m2-verify/
  - https://ai-cooperation.github.io/workshop/test-m2-agent/

### 靜態開源系統分析
- Phase 1（零建置）：markdown-editor, todo-app, budget-tracker, PlainAdmin, kanban-light
- Phase 2（簡單設定）：E-Com-LocalStorage, Inventory Management, Kanban-Board
- Phase 3（需建置）：Laverna, PWA POS Terminal, TUI Calendar
- 發現：純靜態 ERP/MES 極少，用庫存管理+看板替代

### Git Commits
- acmacmini2: fd03607 (v5.0.1, 298 files)
- ac-mac KB: 9c1ea5c (static systems analysis)

## 待辦事項（截至 2026-01-31 結束）

### 高優先
1. **重新跑模擬測試** — 用更新後的 M6 Quarto pipeline + M2 絕對路徑，驗證端到端真實交付物（PPTX 有模板、網站有部署 URL）
2. **設計真實交付物測試場景** — 內容改為：
   - 網站：個人介紹、作品集、公司官網（套模板 + 部署到 GitHub Pages）
   - 簡報：AI 創業、ClawdBot、Happy Coder、Agent 等商業主題（套 rich/roadmap 模板）
   - 開源系統部署：Phase 1 靜態系統（kanban、電商、筆記本等）
3. **PPTX LLM 品質抽檢整合** — M6 的 llm_spot_check 步驟需確認 AgentExecutor 能正確執行 llm_classify action 並讀取 PNG

### 中優先
4. **部署 Phase 1 靜態開源系統** — 5 個零建置系統（markdown-editor, todo-app, budget-tracker, PlainAdmin, kanban-light）到 GitHub Pages
5. **Telegram Bot /happy 命令整合** — 按 plan（snazzy-cooking-firefly.md）實作 TG Bot 操作 Claude Code session
6. **M2 固定管線持續修復** — M-SYS 修復後應重回固定管線繼續（非直接 fallback dynamic）

### 低優先
7. **AgentExecutor 支援 module.yaml（小寫）** — 目前只載入 MODULE.yaml（大寫）
8. **清理測試部署** — 移除 test-m2-verify、test-m2-agent、test-deploy-check
9. **ac-mac knowledge-base git push** — 領先 origin 24+ commits
